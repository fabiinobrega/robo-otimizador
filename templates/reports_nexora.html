{% extends "base_nexora.html" %}

{% block title %}Relatórios - NEXORA{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="nexora-page-header">
    <h1 class="nexora-page-title">Relatórios de Performance</h1>
    <p class="nexora-page-subtitle">Análise completa de suas campanhas e métricas</p>
</div>

<!-- Actions Bar -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-6);">
    <div style="display: flex; gap: var(--spacing-3);">
        <select class="form-input-nexora" style="width: 180px;" id="periodFilter" onchange="applyFilters()">
            <option value="7days">Últimos 7 dias</option>
            <option value="30days" selected>Últimos 30 dias</option>
            <option value="90days">Últimos 90 dias</option>
            <option value="custom">Personalizado</option>
        </select>
        
        <select class="form-input-nexora" style="width: 180px;" id="campaignFilter" onchange="applyFilters()">
            <option value="">Todas as campanhas</option>
            <option value="1">Black Friday 2024</option>
            <option value="2">Lançamento Produto X</option>
            <option value="3">Remarketing Q4</option>
        </select>
    </div>
    
    <div style="display: flex; gap: var(--spacing-2);">
        <button class="btn-nexora btn-nexora-secondary" onclick="exportReport('pdf')">
            <i class="fas fa-file-pdf"></i>
            Exportar PDF
        </button>
        <button class="btn-nexora btn-nexora-secondary" onclick="exportReport('excel')">
            <i class="fas fa-file-excel"></i>
            Exportar Excel
        </button>
    </div>
</div>

<!-- KPIs Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: var(--spacing-4); margin-bottom: var(--spacing-8);">
    <div class="nexora-stat-card">
        <div class="nexora-stat-label">Investimento Total</div>
        <div class="nexora-stat-value" style="font-size: var(--text-2xl);">R$ 12.450</div>
        <div class="nexora-stat-change positive">
            <i class="fas fa-arrow-up"></i> 12% vs. período anterior
        </div>
    </div>
    
    <div class="nexora-stat-card">
        <div class="nexora-stat-label">Receita Gerada</div>
        <div class="nexora-stat-value" style="font-size: var(--text-2xl);">R$ 38.920</div>
        <div class="nexora-stat-change positive">
            <i class="fas fa-arrow-up"></i> 18% vs. período anterior
        </div>
    </div>
    
    <div class="nexora-stat-card">
        <div class="nexora-stat-label">ROAS Médio</div>
        <div class="nexora-stat-value" style="font-size: var(--text-2xl);">3.13x</div>
        <div class="nexora-stat-change positive">
            <i class="fas fa-arrow-up"></i> 5% vs. período anterior
        </div>
    </div>
    
    <div class="nexora-stat-card">
        <div class="nexora-stat-label">Conversões</div>
        <div class="nexora-stat-value" style="font-size: var(--text-2xl);">1.247</div>
        <div class="nexora-stat-change positive">
            <i class="fas fa-arrow-up"></i> 22% vs. período anterior
        </div>
    </div>
</div>

<!-- Charts Grid -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-6); margin-bottom: var(--spacing-8);">
    <!-- Performance Over Time -->
    <div class="nexora-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-5);">
            <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--text-primary); margin: 0;">Performance ao Longo do Tempo</h3>
            <div style="display: flex; gap: var(--spacing-2);">
                <button class="btn-nexora btn-nexora-secondary" style="font-size: var(--text-xs); padding: var(--spacing-1) var(--spacing-3);" onclick="changeMetric('revenue')">Receita</button>
                <button class="btn-nexora btn-nexora-secondary" style="font-size: var(--text-xs); padding: var(--spacing-1) var(--spacing-3);" onclick="changeMetric('conversions')">Conversões</button>
                <button class="btn-nexora btn-nexora-secondary" style="font-size: var(--text-xs); padding: var(--spacing-1) var(--spacing-3);" onclick="changeMetric('roas')">ROAS</button>
            </div>
        </div>
        <canvas id="performanceChart" style="max-height: 300px;"></canvas>
    </div>
    
    <!-- Platform Distribution -->
    <div class="nexora-card">
        <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-5);">Distribuição por Plataforma</h3>
        <canvas id="platformChart" style="max-height: 200px;"></canvas>
        <div style="margin-top: var(--spacing-5); display: flex; flex-direction: column; gap: var(--spacing-3);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                    <div style="width: 12px; height: 12px; background-color: #4f46e5; border-radius: 2px;"></div>
                    <span style="font-size: var(--text-sm); color: var(--text-secondary);">Facebook</span>
                </div>
                <span style="font-size: var(--text-sm); font-weight: 600; color: var(--text-primary);">45%</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                    <div style="width: 12px; height: 12px; background-color: #22c55e; border-radius: 2px;"></div>
                    <span style="font-size: var(--text-sm); color: var(--text-secondary);">Google</span>
                </div>
                <span style="font-size: var(--text-sm); font-weight: 600; color: var(--text-primary);">30%</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                    <div style="width: 12px; height: 12px; background-color: #f97316; border-radius: 2px;"></div>
                    <span style="font-size: var(--text-sm); color: var(--text-secondary);">Instagram</span>
                </div>
                <span style="font-size: var(--text-sm); font-weight: 600; color: var(--text-primary);">20%</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: var(--spacing-2);">
                    <div style="width: 12px; height: 12px; background-color: #737373; border-radius: 2px;"></div>
                    <span style="font-size: var(--text-sm); color: var(--text-secondary);">TikTok</span>
                </div>
                <span style="font-size: var(--text-sm); font-weight: 600; color: var(--text-primary);">5%</span>
            </div>
        </div>
    </div>
</div>

<!-- Engagement Metrics -->
<div class="nexora-card" style="margin-bottom: var(--spacing-8);">
    <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-5);">Métricas de Engajamento</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-6); margin-bottom: var(--spacing-5);">
        <div style="text-align: center;">
            <div style="font-size: var(--text-3xl); font-weight: 700; color: var(--accent-primary);">2.4M</div>
            <div style="font-size: var(--text-sm); color: var(--text-tertiary); margin-top: var(--spacing-1);">Impressões</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: var(--text-3xl); font-weight: 700; color: var(--accent-success);">48.5K</div>
            <div style="font-size: var(--text-sm); color: var(--text-tertiary); margin-top: var(--spacing-1);">Cliques</div>
        </div>
        <div style="text-align: center;">
            <div style="font-size: var(--text-3xl); font-weight: 700; color: var(--accent-info);">2.02%</div>
            <div style="font-size: var(--text-sm); color: var(--text-tertiary); margin-top: var(--spacing-1);">CTR</div>
        </div>
    </div>
    <canvas id="engagementChart" style="max-height: 200px;"></canvas>
</div>

<!-- Top Campaigns -->
<div class="nexora-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-5);">
        <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--text-primary); margin: 0;">Top 10 Campanhas por Performance</h3>
    </div>
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--border-primary);">
                    <th style="text-align: left; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">#</th>
                    <th style="text-align: left; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">Campanha</th>
                    <th style="text-align: left; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">Plataforma</th>
                    <th style="text-align: right; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">Investido</th>
                    <th style="text-align: right; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">Receita</th>
                    <th style="text-align: right; padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-tertiary);">ROAS</th>
                </tr>
            </thead>
            <tbody id="topCampaignsTable">
                <tr>
                    <td colspan="6" style="text-align: center; padding: var(--spacing-8);">
                        <div class="nexora-spinner" style="margin: 0 auto;"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- AI Insights -->
<div class="nexora-card" style="margin-top: var(--spacing-8); border: 1px solid var(--accent-primary);">
    <div style="display: flex; gap: var(--spacing-4);">
        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, var(--accent-primary) 0%, #6366f1 100%); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <i class="fas fa-brain" style="font-size: var(--text-xl); color: var(--text-on-accent);"></i>
        </div>
        <div style="flex: 1;">
            <h3 style="font-size: var(--text-lg); font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-2);">Insights da IA Velyra Prime</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-5);">
                <div>
                    <div style="font-size: var(--text-sm); font-weight: 600; color: var(--accent-success); margin-bottom: var(--spacing-2);">✓ Pontos Fortes</div>
                    <ul style="margin: 0; padding-left: var(--spacing-5); font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.8;">
                        <li>ROAS 56% acima da média do setor</li>
                        <li>Taxa de conversão cresceu 22% no período</li>
                        <li>Campanhas de remarketing com performance excepcional</li>
                    </ul>
                </div>
                <div>
                    <div style="font-size: var(--text-sm); font-weight: 600; color: var(--accent-warning); margin-bottom: var(--spacing-2);">⚠ Oportunidades</div>
                    <ul style="margin: 0; padding-left: var(--spacing-5); font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.8;">
                        <li>CTR no Google Ads 15% abaixo do benchmark</li>
                        <li>Considere aumentar orçamento em campanhas top 3</li>
                        <li>Teste novos criativos para campanhas com CTR baixo</li>
                    </ul>
                </div>
            </div>
            <div style="margin-top: var(--spacing-4);">
                <a href="/velyra_prime" class="btn-nexora btn-nexora-primary">
                    <i class="fas fa-robot"></i>
                    Ver Análise Completa
                </a>
            </div>
        </div>
    </div>
</div>

<script>
let performanceChart, platformChart, engagementChart;

function initCharts() {
    // Performance Chart
    const perfCtx = document.getElementById('performanceChart').getContext('2d');
    performanceChart = new Chart(perfCtx, {
        type: 'line',
        data: {
            labels: ['1 Nov', '5 Nov', '10 Nov', '15 Nov', '20 Nov', '25 Nov', '30 Nov'],
            datasets: [{
                label: 'Receita',
                data: [1200, 1900, 1500, 2200, 2800, 2400, 3100],
                borderColor: '#4f46e5',
                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: '#262626' },
                    ticks: { color: '#737373' }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: '#737373' }
                }
            }
        }
    });
    
    // Platform Chart
    const platCtx = document.getElementById('platformChart').getContext('2d');
    platformChart = new Chart(platCtx, {
        type: 'doughnut',
        data: {
            labels: ['Facebook', 'Google', 'Instagram', 'TikTok'],
            datasets: [{
                data: [45, 30, 20, 5],
                backgroundColor: ['#4f46e5', '#22c55e', '#f97316', '#737373']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } }
        }
    });
    
    // Engagement Chart
    const engCtx = document.getElementById('engagementChart').getContext('2d');
    engagementChart = new Chart(engCtx, {
        type: 'bar',
        data: {
            labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
            datasets: [{
                label: 'Cliques',
                data: [6500, 7200, 6800, 7500, 8200, 5400, 4900],
                backgroundColor: '#22c55e'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: '#262626' },
                    ticks: { color: '#737373' }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: '#737373' }
                }
            }
        }
    });
}

async function loadTopCampaigns() {
    const campaigns = [
        { rank: 1, name: 'Black Friday 2024', platform: 'Facebook', spent: 2500, revenue: 9800, roas: 3.92 },
        { rank: 2, name: 'Remarketing Q4', platform: 'Google', spent: 1800, revenue: 7200, roas: 4.00 },
        { rank: 3, name: 'Lançamento Produto X', platform: 'Instagram', spent: 3200, revenue: 11500, roas: 3.59 },
    ];
    
    const tbody = document.getElementById('topCampaignsTable');
    tbody.innerHTML = campaigns.map(c => `
        <tr style="border-bottom: 1px solid var(--border-primary);">
            <td style="padding: var(--spacing-3);">
                <span style="display: inline-block; width: 24px; height: 24px; background-color: var(--accent-warning); border-radius: var(--radius-md); text-align: center; line-height: 24px; font-size: var(--text-xs); font-weight: 600; color: var(--text-on-accent);">${c.rank}</span>
            </td>
            <td style="padding: var(--spacing-3); font-size: var(--text-sm); font-weight: 500; color: var(--text-primary);">${c.name}</td>
            <td style="padding: var(--spacing-3);">
                <span style="display: inline-block; padding: 4px 8px; background-color: var(--fill-secondary); border-radius: var(--radius-md); font-size: var(--text-xs); color: var(--text-secondary);">${c.platform}</span>
            </td>
            <td style="padding: var(--spacing-3); text-align: right; font-size: var(--text-sm); color: var(--text-secondary);">${NEXORA.formatCurrency(c.spent)}</td>
            <td style="padding: var(--spacing-3); text-align: right; font-size: var(--text-sm); color: var(--text-secondary);">${NEXORA.formatCurrency(c.revenue)}</td>
            <td style="padding: var(--spacing-3); text-align: right; font-size: var(--text-sm); font-weight: 600; color: var(--accent-success);">${c.roas.toFixed(2)}x</td>
        </tr>
    `).join('');
}

function applyFilters() {
    console.log('Filters applied');
}

function changeMetric(metric) {
    console.log('Metric changed to:', metric);
}

function exportReport(format) {
    NEXORA.showToast('Exportando', `Gerando relatório em ${format.toUpperCase()}...`, 'info');
    setTimeout(() => {
        NEXORA.showToast('Sucesso', 'Relatório exportado com sucesso!', 'success');
    }, 1500);
}

document.addEventListener('DOMContentLoaded', () => {
    initCharts();
    loadTopCampaigns();
});
</script>
{% endblock %}
