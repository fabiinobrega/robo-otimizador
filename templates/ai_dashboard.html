<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de IA - NEXORA PRIME</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nexora_premium_v3.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nexora_ai_v4.css') }}">
    
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '865226839589725');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=865226839589725&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1>ü§ñ Dashboard de IA</h1>
                <p class="subtitle">Intelig√™ncia Artificial Integrada: ChatGPT + Manus</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openCreateCampaignModal()">
                    ‚ú® Criar Campanha com IA
                </button>
            </div>
        </header>

        <!-- Status da Orquestra√ß√£o -->
        <section class="orchestration-status">
            <div class="status-card">
                <div class="status-icon">üß†</div>
                <div class="status-info">
                    <h3>ChatGPT</h3>
                    <p class="status-label" id="gpt-status">Verificando...</p>
                    <span class="status-badge" id="gpt-badge">‚è≥</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon">‚öôÔ∏è</div>
                <div class="status-info">
                    <h3>Manus Executor</h3>
                    <p class="status-label" id="manus-status">Verificando...</p>
                    <span class="status-badge" id="manus-badge">‚è≥</span>
                </div>
            </div>
            <div class="status-card">
                <div class="status-icon">üîó</div>
                <div class="status-info">
                    <h3>Orquestrador</h3>
                    <p class="status-label" id="orchestrator-status">Verificando...</p>
                    <span class="status-badge" id="orchestrator-badge">‚è≥</span>
                </div>
            </div>
        </section>

        <!-- Fluxo de Trabalho -->
        <section class="workflow-section">
            <h2>üîÑ Fluxo de Trabalho IA</h2>
            <div class="workflow-diagram">
                <div class="workflow-step">
                    <div class="step-icon">üß†</div>
                    <h3>1. ChatGPT</h3>
                    <p>Cria estrat√©gia e copy</p>
                </div>
                <div class="workflow-arrow">‚Üí</div>
                <div class="workflow-step">
                    <div class="step-icon">üéØ</div>
                    <h3>2. Orchestrator</h3>
                    <p>Estrutura e traduz</p>
                </div>
                <div class="workflow-arrow">‚Üí</div>
                <div class="workflow-step">
                    <div class="step-icon">‚öôÔ∏è</div>
                    <h3>3. Manus</h3>
                    <p>Executa e aplica</p>
                </div>
                <div class="workflow-arrow">‚Üí</div>
                <div class="workflow-step">
                    <div class="step-icon">üöÄ</div>
                    <h3>4. Nexora</h3>
                    <p>Publica e vende</p>
                </div>
            </div>
        </section>

        <!-- Execu√ß√µes Recentes -->
        <section class="executions-section">
            <h2>üìä Execu√ß√µes Recentes</h2>
            <div class="executions-list" id="executions-list">
                <p class="loading">Carregando execu√ß√µes...</p>
            </div>
        </section>

        <!-- A√ß√µes R√°pidas -->
        <section class="quick-actions">
            <h2>‚ö° A√ß√µes R√°pidas</h2>
            <div class="actions-grid">
                <div class="action-card" onclick="createCampaignWithAI()">
                    <div class="action-icon">üéØ</div>
                    <h3>Criar Campanha</h3>
                    <p>Campanha completa com IA</p>
                </div>
                <div class="action-card" onclick="generateCopy()">
                    <div class="action-icon">‚úçÔ∏è</div>
                    <h3>Gerar Copy</h3>
                    <p>Headlines e descri√ß√µes</p>
                </div>
                <div class="action-card" onclick="analyzePerformance()">
                    <div class="action-icon">üìà</div>
                    <h3>Analisar Performance</h3>
                    <p>Insights com ChatGPT</p>
                </div>
                <div class="action-card" onclick="optimizeCampaigns()">
                    <div class="action-icon">üîß</div>
                    <h3>Otimizar Campanhas</h3>
                    <p>Recomenda√ß√µes inteligentes</p>
                </div>
                <div class="action-card" onclick="createFunnel()">
                    <div class="action-icon">üé™</div>
                    <h3>Criar Funil</h3>
                    <p>Funil completo automatizado</p>
                </div>
                <div class="action-card" onclick="createPersona()">
                    <div class="action-icon">üë§</div>
                    <h3>Criar Persona</h3>
                    <p>An√°lise de p√∫blico-alvo</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal de Cria√ß√£o de Campanha -->
    <div id="createCampaignModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>‚ú® Criar Campanha com IA</h2>
            
            <form id="campaignForm">
                <div class="form-group">
                    <label>Nome da Campanha</label>
                    <input type="text" id="campaign-name" placeholder="Ex: Lan√ßamento Produto X" required>
                </div>
                
                <div class="form-group">
                    <label>Produto/Servi√ßo</label>
                    <input type="text" id="campaign-product" placeholder="Descreva seu produto" required>
                </div>
                
                <div class="form-group">
                    <label>Objetivo</label>
                    <select id="campaign-objective">
                        <option value="CONVERSIONS">Convers√µes</option>
                        <option value="TRAFFIC">Tr√°fego</option>
                        <option value="AWARENESS">Awareness</option>
                        <option value="LEADS">Gera√ß√£o de Leads</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Or√ßamento Di√°rio (R$)</label>
                    <input type="number" id="campaign-budget" placeholder="100" min="10" required>
                </div>
                
                <div class="form-group">
                    <label>P√∫blico-Alvo</label>
                    <textarea id="campaign-audience" placeholder="Descreva seu p√∫blico-alvo" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Plataformas</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" name="platform" value="google" checked> Google Ads</label>
                        <label><input type="checkbox" name="platform" value="facebook"> Facebook Ads</label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üöÄ Criar com IA</button>
                </div>
            </form>
            
            <div id="creation-progress" class="progress-section" style="display: none;">
                <h3>Criando campanha...</h3>
                <div class="progress-steps" id="progress-steps"></div>
            </div>
        </div>
    </div>

    <script>
        // Verificar status da orquestra√ß√£o
        async function checkOrchestrationStatus() {
            try {
                const response = await fetch('/api/orchestration/status');
                const data = await response.json();
                
                if (data.success) {
                    const status = data.status;
                    
                    // Atualizar status do GPT
                    updateStatus('gpt', status.gpt_strategic_available && status.gpt_campaign_available);
                    
                    // Atualizar status do Manus
                    updateStatus('manus', status.manus_executor_available);
                    
                    // Atualizar status do Orchestrator
                    updateStatus('orchestrator', true);
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
            }
        }
        
        function updateStatus(component, available) {
            const statusLabel = document.getElementById(`${component}-status`);
            const statusBadge = document.getElementById(`${component}-badge`);
            
            if (available) {
                statusLabel.textContent = 'Dispon√≠vel';
                statusBadge.textContent = '‚úÖ';
                statusBadge.className = 'status-badge status-online';
            } else {
                statusLabel.textContent = 'Indispon√≠vel';
                statusBadge.textContent = '‚ùå';
                statusBadge.className = 'status-badge status-offline';
            }
        }
        
        // Modal
        function openCreateCampaignModal() {
            document.getElementById('createCampaignModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('createCampaignModal').style.display = 'none';
            document.getElementById('creation-progress').style.display = 'none';
            document.getElementById('campaignForm').style.display = 'block';
        }
        
        // Criar campanha com IA
        document.getElementById('campaignForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Coletar dados
            const platforms = Array.from(document.querySelectorAll('input[name="platform"]:checked'))
                .map(cb => cb.value);
            
            const campaignData = {
                name: document.getElementById('campaign-name').value,
                product: document.getElementById('campaign-product').value,
                objective: document.getElementById('campaign-objective').value,
                budget: parseFloat(document.getElementById('campaign-budget').value),
                audience: document.getElementById('campaign-audience').value,
                platforms: platforms
            };
            
            // Mostrar progresso
            document.getElementById('campaignForm').style.display = 'none';
            document.getElementById('creation-progress').style.display = 'block';
            
            const progressSteps = document.getElementById('progress-steps');
            progressSteps.innerHTML = '<p>‚è≥ Iniciando cria√ß√£o...</p>';
            
            try {
                const response = await fetch('/api/orchestration/create-deploy-campaign', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(campaignData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    progressSteps.innerHTML = `
                        <p>‚úÖ Campanha criada com sucesso!</p>
                        <p><strong>ID:</strong> ${result.campaign_id}</p>
                        <p><strong>Execu√ß√£o:</strong> ${result.execution_id}</p>
                    `;
                    
                    setTimeout(() => {
                        closeModal();
                        location.reload();
                    }, 3000);
                } else {
                    progressSteps.innerHTML = `<p>‚ùå Erro: ${result.error}</p>`;
                }
            } catch (error) {
                progressSteps.innerHTML = `<p>‚ùå Erro: ${error.message}</p>`;
            }
        });
        
        // A√ß√µes r√°pidas
        function createCampaignWithAI() {
            openCreateCampaignModal();
        }
        
        function generateCopy() {
            alert('Funcionalidade de gera√ß√£o de copy em desenvolvimento');
        }
        
        function analyzePerformance() {
            alert('Funcionalidade de an√°lise de performance em desenvolvimento');
        }
        
        function optimizeCampaigns() {
            alert('Funcionalidade de otimiza√ß√£o em desenvolvimento');
        }
        
        function createFunnel() {
            alert('Funcionalidade de cria√ß√£o de funil em desenvolvimento');
        }
        
        function createPersona() {
            alert('Funcionalidade de cria√ß√£o de persona em desenvolvimento');
        }
        
        // Inicializar
        checkOrchestrationStatus();
        setInterval(checkOrchestrationStatus, 30000); // Atualizar a cada 30s
    </script>
</body>
</html>
